---
title: Java 中经典垃圾回收器(Garbage Collector)
date: 2024-11-24 22:50:00
category:
    - 笔记
tag: 
    - Java
    - JVM
    - 技术笔记
description: 记录一些Java 中经典垃圾回收器，以备查看。
---
# Java 中经典垃圾回收器

垃圾收集器是内存管理工具，也就是垃圾回收的具体实现。

![HotSpot 虚拟机的垃圾收集器](/assets/images/notes/java/jvm/garbageCollectorScenario.jpg)	
> 图上是七种不同分代的收集器，如果两个收集器之间存在连线，就说明它们之间可以搭配使用，图中收集器所处的区域，则表示它是新生代收集器还是老年代收集器。
## 简单概念

### 并行和并发
> 并行（Parallel）：指多条垃圾收集线程并行工作，但此时用户线程仍然处于等待状态。   
> 
> 并发（Concurrent）：指用户线程与垃圾收集线程同时执行（但不一定是并行的，可能会交替执行），用户程序在继续运行。而垃圾收集程序运行在另一个CPU上。
### 吞吐量（Throughput）
> 吞吐量就是CPU用于运行用户代码的时间与CPU总消耗时间的比值，即
吞吐量 = 运行用户代码时间 /（运行用户代码时间 + 垃圾收集时间）。
假设虚拟机总共运行了100分钟，其中垃圾收集花掉1分钟，那吞吐量就是99%。

### GC 类型
#### 部分收集 (Partial GC)
Partial GC 指的是目标不是完整收集整个 Java 堆的垃圾收集，其中又分为
* 新生代收集 (Minor GC/Young GC)：指目标只是新生代的垃圾收集。
* 老年代收集 (Major GC/Old GC)：指目标只是老年代的垃圾收集。
  > 目前只有 CMS 收集器会有单独收集老年代的行为。(Major GC 说法有点混淆，需要根据上下文区分到底是指老年代收集还是整堆收集。)
* 混合收集(Mixed GC)：指目标是收集整个新生代以及部分老年代的垃圾收集。
  > 目前只有 G1 收集器会有这种行为
#### 整堆收集 (Full GC)
收集整个 Java 堆和方法区的垃圾收集。

## Serial 收集器
Serial 垃圾收集器是最基本的垃圾收集器，它是单线程的收集器。单线程的意思是，它进行垃圾回收时必须暂停其他所有的工作线程，直到它收集结束。
在服务器环境中使用它体验感很不好，想一下用户访问网站。。结果垃圾收集一下暂停一下。。。。
但它是虚拟机运行在Client模式下的默认新生代收集器，因为桌面应用新生代内存不会太大，停顿时间可以控制一百毫秒以内，只要不是频繁发生，还是可以接受的。
## Serial Old 收集器
Serial Old 是 Serial 的老年代版本。它也是单线程收集器。使用标记整理算法。主要也是给Client 模式下的虚拟机使用。

## ParNew 收集器
ParNew 收集器是 Serial 收集器的多线程版本，其他与Serial 收集器没有什么太大的区别。它是Server模式下的虚拟机中首选的新生代收集器。
## Parallel Scavenge 收集器
Parallel Scavenge 收集器是一个新生代收集器，它也是使用复制算法的收集器，也是并行的多线程收集器。
Parallel Scavenge 收集器的目标是达到一个可控制的吞吐量。
吞吐量=运行代码时间/(运行代码时间+垃圾收集时间）

## Parallel Old 收集器
Parallel Old 是 Parallel Scavenge 收集器的老年代版本，使用多线程和标记整理算法。

## CMS(Concurrent Mark Sweep)收集器
CMS 是一种以获得最短回收停顿时间为目标的收集器。CMS是基于标记清除算法来实现的。

## G1(Garbage-First)收集器
G1是一款面向服务端应用的垃圾收集器。
G1 将整个java堆划分为多个大小相等的独立区域，有计划的避免进行全区域的垃圾回收。G1跟踪各个区域的垃圾堆积的价值大小(回收所获得的空间大小以及回收所需要时间的经验值)，维护 一个优先列表，每次根据允许的收集时间，优先回收价值最大的区域。

# 相关资料
[深入理解 Java 虚拟机-周志明](https://book.douban.com/subject/6522893/)